@model TMD.Models.BrowseSubsiteModel
@{ ViewBag.Title = "Site Details"; Layout = "~/Views/Shared/SiteLayout.cshtml"; }

@section Styles {
    <style type="text/css">
        .Map { height: 400px; width: 100%; }
    </style>
}

@section Scripts {
    <script type="text/javascript"src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="@Url.ManagedContent(Links.js.Map_js, Links.js.Map_min_js)" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            slate.portlet.init();
            $('#LocationMap').bind('PortletTabActivated', function () {
                $('.Map').Mapify();
            });
        });
    </script>
}

<div class="x6">

	<div class="portlet x12">
		<div class="portlet-header"><h4>Site</h4></div>
		<div class="portlet-content">
			<table class="reports_table">                
                @Html.ReportDisplayFor(m => m.Details.Name)
                @Html.ReportDisplayFor(m => m.Details.RHI5)
                @Html.ReportDisplayFor(m => m.Details.RHI10)
                @Html.ReportDisplayFor(m => m.Details.RHI20)
                @Html.ReportDisplayFor(m => m.Details.RGI5)
                @Html.ReportDisplayFor(m => m.Details.RGI10)
                @Html.ReportDisplayFor(m => m.Details.RGI20)
                @Html.ReportDisplayFor(m => m.Details.LastVisited)
                @if (Model.Details.MakeOwnershipContactInfoPublic) { 
                    @Html.ReportDisplayFor(m => m.Details.OwnershipContactInfo)
                } else {
                    <tr>
                        <td class="description">Ownership contact</td>
                        <td class="value">(private)</td>
                    </tr>
                }
                @Html.ReportDisplayFor(m => m.Details.LastVisitComments)
                @Html.ReportDisplayFor(m => m.Details.Visitors)
			</table>
		</div>
	</div>

    <div class="portlet x12">
		<div class="portlet-header"><h4>Species</h4></div>
		<div class="portlet-content">               
            @(Html.DataTablesGrid<TMD.Model.Trees.SubsiteMeasuredSpecies>(
                columns: builder =>
                {
                    builder
                        .Custom("Botanical name", species => Html.ActionLink(species.ScientificName, Mvc.Browse.SpeciesDetails(species.Id)))
                        .Options(canSort: false);
                    builder
                        .Custom("Common name", species => Html.ActionLink(species.CommonName, Mvc.Browse.SpeciesDetails(species.Id)))
                        .Options(canSort: false);
                    builder
                        .Custom("Max height", species => species.MaxHeight.IsValidAndSpecified() ? 
                            Html.ActionLink(species.MaxHeight.ToString(DistanceFormat.Default) , Mvc.Browse.TreeDetails(species.MaxHeightTree.Id))
                            : MvcHtmlString.Create("-"))
                        .Options(canSort: false);
                    builder
                        .Custom("Max girth", species => species.MaxGirth.IsValidAndSpecified() ?
                            Html.ActionLink(species.MaxHeight.ToString(DistanceFormat.FeetDecimalInches), Mvc.Browse.TreeDetails(species.MaxGirthTree.Id))
                            : MvcHtmlString.Create("-"))
                        .Options(canSort: false);
                    builder
                        .Custom("Max crown spread", species => species.MaxCrownSpread.IsValidAndSpecified() ?
                            Html.ActionLink(species.MaxHeight.ToString(DistanceFormat.Default), Mvc.Browse.TreeDetails(species.MaxCrownSpreadTree.Id))
                            : MvcHtmlString.Create("-"))
                        .Options(canSort: false);
                },
                canPage: false,
                dataSource: Model.Species))
		</div>
	</div>

</div>
<div class="x6">

	<div class="portlet x12">
		<div class="portlet-header">
            <h4>Location</h4>
            <ul class="portlet-tab-nav">
                <li class="portlet-tab-nav-active"><a href="#LocationSummary">Summary</a></li>
                <li><a href="#LocationMap">Map</a></li>
            </ul>
        </div>
		<div class="portlet-content">
            <div id="LocationSummary" class="portlet-tab-content portlet-tab-content-active">
                <table class="reports_table">
                    @if (Model.Location.Coordinates.IsValidAndSpecified()) {
                        @Html.ReportDisplayFor(m => m.Location.Coordinates);
                    } else {
                        @Html.ReportDisplayFor(m => m.Location.CalculatedCoordinates);
                    }
				    @Html.ReportDisplayFor(m => m.Location.OwnershipType)
				    @Html.ReportDisplayFor(m => m.Location.County)
                    <tr>
                        <td class="description">State</td>
                        <td class="value"><a href="@Url.Action(Mvc.Browse.StateDetails(Model.Location.State.Id))">@Html.DisplayFor(m => m.Location.State)</a></td>
                    </tr>
                </table>
            </div>
            <div id="LocationMap" class="portlet-tab-content RequiresJavascript">
                @Html.DisplayFor(m => m.Location.Map)
            </div>
		</div>
	</div>

	<div class="portlet x12">
		<div class="portlet-header"><h4>Photos</h4></div>
		<div class="portlet-content">
            @Html.DisplayFor(m => m.PhotoSummaries, "BrowsePhotoSummaryList")
		</div>
	</div>

</div>
