(function(a){a.fn.InitializeSitesUi=function(b){return this.each(function(){a(this).find(".gallery").not(".UiSitesInitialized").addClass("UiSitesInitialized").PhotoGallery();
a(this).find(".CoordinatePicker").not(".UiSitesInitialized").addClass("UiSitesInitialized").CoordinatePicker({AddressCalculator:function(){var d=a(this).closest(".Site, .Subsite").find(".County input[type=text]");
var e=a(this).closest(".Site, .Subsite").find(".State select");
if(!d.val().IsNullOrWhitespace()&&e.find("option:selected").length>0){return d.val()+" County, "+e.find("option:selected").text()
}if(e.find("option:selected").length>0){return e.find("option:selected").text()
}return null
}});
a(this).find(".Coordinates input[type=text]").not(".UiSitesInitialized").addClass("UiSitesInitialized").change(function(){var d=a(this);
var e=Coordinates.Parse(d.val());
if(e.IsSpecified()&&e.IsValid()){new google.maps.Geocoder().geocode({latLng:new google.maps.LatLng(e.Latitude().TotalDegrees(),e.Longitude().TotalDegrees())},function(m,p){if(p==google.maps.GeocoderStatus.OK){var l,n,k;
for(i in m[0].address_components){for(j in m[0].address_components[i].types){if(m[0].address_components[i].types[j]=="administrative_area_level_2"){l=m[0].address_components[i].long_name
}if(m[0].address_components[i].types[j]=="administrative_area_level_1"){n=m[0].address_components[i].long_name
}if(m[0].address_components[i].types[j]=="country"){k=m[0].address_components[i].short_name
}}}if(l!=null){var f=d.closest(".Site, .Subsite").find(".County input[type=text]");
f.val(l)
}if(n!=null&&k!=null){var o=n+" ("+k+")";
var g=d.closest(".Site, .Subsite").find(".State select");
var h=g.find("option").filter(function(){return a(this).text()==o
});
if(h!=null){g.find("option").removeAttr("selected");
h.attr("selected","selected");
a.uniform.update(g)
}}}})
}});
function c(d){var e=d.split(".");
this.Level=e[0];
this.Id=e[1];
this.Action=e[2];
this.Equals=function(g,f){return g==this.Level&f==this.Action
};
this.Serialize=function(){return"innerAction="+this.Level+"."+this.Id+"."+this.Action
}
}a(this).find("button[type=submit][name=innerAction]").not(".UiSitesInitialized").addClass("UiSitesInitialized").click(function(f){var d=a(this);
var e=d.closest("form");
var g=new c(d.attr("value"));
if(g.Equals("Site","Save")||g.Equals("Site","Edit")||g.Equals("Site","Add")||g.Equals("Subsite","Remove")){a.post(e.attr("action"),e.serialize()+"&"+g.Serialize(),function(l){var h=d.closest(".Site");
var k=a(l);
h.replaceWith(k);
k.InitializeUi().InitializeSitesUi();
if(g.Equals("Site","Save")||g.Equals("Site","Edit")){k.SmoothScrollInFocus()
}if(g.Equals("Site","Add")||g.Equals("Subsite","Remove")){k.find(".Subsite:last").SmoothScrollInFocus()
}});
return false
}if(g.Equals("Site","Remove")){a.post(e.attr("action"),e.serialize()+"&"+g.Serialize(),function(l){var h=d.closest(".Sites");
var k=a(l);
h.replaceWith(k);
k.InitializeUi().InitializeSitesUi().find(".Site:last").SmoothScrollInFocus()
});
return false
}if(g.Equals("Trip","Add")){a.post(e.attr("action"),e.serialize()+"&"+g.Serialize(),function(n){var l=d.closest(".Sites");
if(l.find(".Site").length>1){var h=l.find(".Site:last");
var k=a(n);
h.after(k);
k.InitializeUi().InitializeSitesUi().SmoothScrollInFocus()
}else{var m=a(n);
l.replaceWith(m);
m.InitializeUi().InitializeSitesUi().find(".Site:last").SmoothScrollInFocus()
}});
return false
}})
})
}
})(jQuery);
(function(a){a.fn.InitializeTreesUi=function(b){return this.each(function(){a(this).find(".gallery").not(".UiTreesInitialized").addClass("UiTreesInitialized").PhotoGallery();
a(this).find(".CoordinatePicker").not(".UiTreesInitialized").addClass("UiTreesInitialized").CoordinatePicker();
a(this).find(".CommonName input[type=text]").not(".UiTreesInitialized").addClass("UiTreesInitialized").autocomplete({source:"/Trees/FindKnownSpeciesWithSimilarCommonName",minLength:2,select:function(e,f){var d=a(this).closest(".Tree").find(".ScientificName input[type=text]");
d.val(f.item.ScientificName)
}});
a(this).find(".ScientificName input[type=text]").not(".UiTreesInitialized").addClass("UiTreesInitialized").autocomplete({source:"/Trees/FindKnownSpeciesWithSimilarScientificName",minLength:2,select:function(e,f){var d=a(this).closest(".Tree").find(".CommonName input[type=text]");
d.val(f.item.CommonName)
}});
function c(d){var e=d.split(".");
this.Level=e[0];
this.Id=e[1];
this.Action=e[2];
this.Equals=function(g,f){return g==this.Level&f==this.Action
};
this.Serialize=function(){return"innerAction="+this.Level+"."+this.Id+"."+this.Action
}
}a(this).find("button[type=submit][name=innerAction]").not(".UiTreesInitialized").addClass("UiTreesInitialized").click(function(f){var d=a(this);
var e=d.closest("form");
var g=new c(d.attr("value"));
if(g.Equals("Tree","Save")||g.Equals("Tree","Edit")){a.post(e.attr("action"),e.serialize()+"&"+g.Serialize(),function(l){var h=d.closest(".Tree");
var k=a(l);
h.replaceWith(k);
k.InitializeUi().InitializeTreesUi().SmoothScrollInFocus()
});
return false
}if(g.Equals("Subsite","Add")){a.post(e.attr("action"),e.serialize()+"&"+g.Serialize(),function(n){var k=d.closest(".Subsite");
if(k.find(".Tree").length>1){var h=k.find(".Tree:last");
var m=a(n);
h.after(m);
m.InitializeUi().InitializeTreesUi().SmoothScrollInFocus()
}else{var l=a(n);
k.replaceWith(l);
l.InitializeUi().InitializeTreesUi().find(".Tree:last").SmoothScrollInFocus()
}});
return false
}if(g.Equals("Tree","Remove")){a.post(e.attr("action"),e.serialize()+"&"+g.Serialize(),function(l){var h=d.closest(".Subsite");
var k=a(l);
h.replaceWith(k);
k.InitializeUi().InitializeTreesUi().find(".Tree:last").SmoothScrollInFocus()
});
return false
}})
})
}
})(jQuery);