(function(a){a.fn.InitializeSitesUi=function(b){return this.each(function(){a(this).find(".gallery").not(".UiSitesInitialized").addClass("UiSitesInitialized").PhotoGallery();a(this).find(".CoordinatePicker").not(".UiSitesInitialized").addClass("UiSitesInitialized").CoordinatePicker({AddressCalculator:function(){var e=a(this).closest(".Site, .Subsite").find(".County input[type=text]");var d=a(this).closest(".Site, .Subsite").find(".State select");if(!e.val().IsNullOrWhitespace()&&d.find("option:selected").length>0){return e.val()+" County, "+d.find("option:selected").text()}if(d.find("option:selected").length>0){return d.find("option:selected").text()}return null}});a(this).find(".Coordinates input[type=text]").not(".UiSitesInitialized").addClass("UiSitesInitialized").change(function(){var e=a(this);var d=Coordinates.Parse(e.val());if(d.IsSpecified()&&d.IsValid()){new google.maps.Geocoder().geocode({latLng:new google.maps.LatLng(d.Latitude().TotalDegrees(),d.Longitude().TotalDegrees())},function(o,h){if(h==google.maps.GeocoderStatus.OK){var m,g,n;for(i in o[0].address_components){for(j in o[0].address_components[i].types){if(o[0].address_components[i].types[j]=="administrative_area_level_2"){m=o[0].address_components[i].long_name}if(o[0].address_components[i].types[j]=="administrative_area_level_1"){g=o[0].address_components[i].long_name}if(o[0].address_components[i].types[j]=="country"){n=o[0].address_components[i].short_name}}}if(m!=null){var p=e.closest(".Site, .Subsite").find(".County input[type=text]");p.val(m)}if(g!=null&&n!=null){var l=g+" ("+n+")";var k=e.closest(".Site, .Subsite").find(".State select");var f=k.find("option").filter(function(){return a(this).text()==l});if(f!=null){k.find("option").removeAttr("selected");f.attr("selected","selected");a.uniform.update(k)}}}})}});function c(e){var d=e.split(".");this.Level=d[0];this.Id=d[1];this.Action=d[2];this.Equals=function(g,f){return g==this.Level&f==this.Action};this.Serialize=function(){return"innerAction="+this.Level+"."+this.Id+"."+this.Action}}a(this).find("button[type=submit][name=innerAction]").not(".UiSitesInitialized").addClass("UiSitesInitialized").click(function(f){var d=a(this);var g=d.closest("form");var e=new c(d.attr("value"));if(e.Equals("Site","Save")||e.Equals("Site","Edit")||e.Equals("Site","Add")||e.Equals("Subsite","Remove")){a.post(g.attr("action"),g.serialize()+"&"+e.Serialize(),function(k){var h=d.closest(".Site");var l=a(k);h.replaceWith(l);l.InitializeUi().InitializeSitesUi();if(e.Equals("Site","Save")||e.Equals("Site","Edit")){l.SmoothScrollInFocus()}if(e.Equals("Site","Add")||e.Equals("Subsite","Remove")){l.find(".Subsite:last").SmoothScrollInFocus()}});return false}if(e.Equals("Site","Remove")){a.post(g.attr("action"),g.serialize()+"&"+e.Serialize(),function(k){var h=d.closest(".Sites");var l=a(k);h.replaceWith(l);l.InitializeUi().InitializeSitesUi().find(".Site:last").SmoothScrollInFocus()});return false}if(e.Equals("Trip","Add")){a.post(g.attr("action"),g.serialize()+"&"+e.Serialize(),function(m){var l=d.closest(".Sites");if(l.find(".Site").length>1){var k=l.find(".Site:last");var n=a(m);k.after(n);n.InitializeUi().InitializeSitesUi().SmoothScrollInFocus()}else{var h=a(m);l.replaceWith(h);h.InitializeUi().InitializeSitesUi().find(".Site:last").SmoothScrollInFocus()}});return false}})})}})(jQuery);(function(a){a.fn.InitializeTreesUi=function(b){return this.each(function(){a(this).find(".gallery").not(".UiTreesInitialized").addClass("UiTreesInitialized").PhotoGallery();a(this).find(".CoordinatePicker").not(".UiTreesInitialized").addClass("UiTreesInitialized").CoordinatePicker();a(this).find(".CommonName input[type=text]").not(".UiTreesInitialized").addClass("UiTreesInitialized").autocomplete({source:"/Trees/FindKnownSpeciesWithSimilarCommonName",minLength:2,select:function(f,e){var d=a(this).closest(".Tree").find(".ScientificName input[type=text]");d.val(e.item.ScientificName)}});a(this).find(".ScientificName input[type=text]").not(".UiTreesInitialized").addClass("UiTreesInitialized").autocomplete({source:"/Trees/FindKnownSpeciesWithSimilarScientificName",minLength:2,select:function(f,d){var e=a(this).closest(".Tree").find(".CommonName input[type=text]");e.val(d.item.CommonName)}});function c(e){var d=e.split(".");this.Level=d[0];this.Id=d[1];this.Action=d[2];this.Equals=function(g,f){return g==this.Level&f==this.Action};this.Serialize=function(){return"innerAction="+this.Level+"."+this.Id+"."+this.Action}}a(this).find("button[type=submit][name=innerAction]").not(".UiTreesInitialized").addClass("UiTreesInitialized").click(function(f){var d=a(this);var g=d.closest("form");var e=new c(d.attr("value"));if(e.Equals("Tree","Save")||e.Equals("Tree","Edit")){a.post(g.attr("action"),g.serialize()+"&"+e.Serialize(),function(l){var h=d.closest(".Tree");var k=a(l);h.replaceWith(k);k.InitializeUi().InitializeTreesUi().SmoothScrollInFocus()});return false}if(e.Equals("Subsite","Add")){a.post(g.attr("action"),g.serialize()+"&"+e.Serialize(),function(n){var l=d.closest(".Subsite");if(l.find(".Tree").length>1){var k=l.find(".Tree:last");var h=a(n);k.after(h);h.InitializeUi().InitializeTreesUi().SmoothScrollInFocus()}else{var m=a(n);l.replaceWith(m);m.InitializeUi().InitializeTreesUi().find(".Tree:last").SmoothScrollInFocus()}});return false}if(e.Equals("Tree","Remove")){a.post(g.attr("action"),g.serialize()+"&"+e.Serialize(),function(l){var h=d.closest(".Subsite");var k=a(l);h.replaceWith(k);k.InitializeUi().InitializeTreesUi().find(".Tree:last").SmoothScrollInFocus()});return false}})})}})(jQuery);