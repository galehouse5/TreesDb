var CoordinatePicker=new function(){var c={};var a=$("<div id='CoordinatePicker' style='position: absolute; left: 0; right: 0; z-index: 101;'>            <div class='CoordinatePickerMap' style='position: absolute; top: 0; left: 0; bottom: 0; right: 0;'></div>            <div class='portlet x6' style='position: absolute; left: 50%; margin-left: -230px; top: -10px;'>                <div class='portlet-content'>                    <form class='form CoordinatePickerCoordinates'>                        <div class='field'>                            <label for='CoordinatePickerCoordinates' style='width: 100px;'>Coordinates</label>                            <div><span class='input'>                                <input id='CoordinatePickerCoordinates' name='Coordinates' type='text' size='40'>                            </span></div>                            <p class='field_help' style='margin-bottom: 0; margin-left: 120px;'>Latitude, Longitude</p>                            <div class='buttonrow' style='margin-bottom: 0; margin-left: 120px;'>                                <button class='btn' type='Submit' name='Action' value='Save'>Save</button>                                <button class='btn btn-grey' type='Submit' name='Action' value='Back'>Back</button>                            </div>                        </div>                    </form>                </div>            </div>            <div class='portlet x6' style='position: absolute; left: 50%; margin-left: -230px; bottom: -25px;'>                <div class='portlet-content'>                    <form class='form CoordinatePickerAddress'>                        <div class='field'>                            <label for='CoordinatePickerAddress' style='width: 100px;'>Address</label>                            <div><span class='input'>                                <input id='CoordinatePickerAddress' name='Address' type='text' size='40'>                            </span></div>                            <div class='buttonrow' style='margin-bottom: 0; margin-left: 120px;'>                                <button class='btn btn-orange' type='Submit' name='Action' value='Search'>Search</button>                            </div>                        </div>                    </form>                </div>            </div>        </div>");c.GetCoordinates=function(){return Coordinates.Parse(a.find("form.CoordinatePickerCoordinates input[name=Coordinates]").val())};function k(m){a.find("form.CoordinatePickerCoordinates input[name=Coordinates]").val(m.ToString())}c.Options={};c.Open=function(n){if(n!=null){var m={Coordinates:Coordinates.Create(Latitude.Create(36.94167),Longitude.Create(-95.825)),Zoom:5,Markers:null,Callback:function(o){}};c.Options=$.extend(m,n)}e()};c.Close=function(m){b();c.Options.Callback({Success:m,Coordinates:c.GetCoordinates()})};var f,g;function e(){k(c.Options.Coordinates);$("body").css("overflow","hidden").append(a);$(window).bind("resize",l).bind("keyup",function(p){if(p.keyCode==27){c.Close(false)}});a.find("form.CoordinatePickerCoordinates button[name=Action]").click(function(){if($(this).val()=="Save"){c.Close(true)}else{if($(this).val()=="Back"){c.Close(false)}}return false});a.find("form.CoordinatePickerCoordinates input[name=Coordinates]").change(function(){var p=Coordinates.Parse($(this).val());if(p.IsSpecified()&&p.IsValid()){g.setPosition(new google.maps.LatLng(p.Latitude().TotalDegrees(),p.Longitude().TotalDegrees()))}});a.find("form.CoordinatePickerAddress").submit(function(){var p=$(this).find("input[name=Address]");p.removeClass("input-validation-error").parent().find(".field-validation-error").remove();if(p.val().IsNullOrWhitespace()){p.addClass("input-validation-error").after($('<span class="field-validation-error" style="margin-left: 120px;">You must specify an address.</span>'))}else{new google.maps.Geocoder().geocode({address:p.val()},function(q,r){if(r==google.maps.GeocoderStatus.OK){p.val(q[0].formatted_address);g.setPosition(q[0].geometry.location);d()}else{p.addClass("input-validation-error").after($('<span class="field-validation-error" style="margin-left: 120px;">Unable to locate this address.</span>'))}})}return false});var m=new google.maps.LatLng(c.Options.Coordinates.Latitude().TotalDegrees(),c.Options.Coordinates.Longitude().TotalDegrees());var o={center:m,zoom:c.Options.Zoom,mapTypeId:google.maps.MapTypeId.TERRAIN,scaleControl:true,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID],position:google.maps.ControlPosition.RIGHT_BOTTOM,style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR},navigationControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM,style:google.maps.NavigationControlStyle.SMALL}};f=new google.maps.Map(a.find(".CoordinatePickerMap")[0],o);g=new google.maps.Marker({position:m,map:f,draggable:true,zIndex:1000});f.getSingletonInfoWindow().setContent("Drag this marker into position to pick a coordinate.");f.UseEventListener(google.maps.event.addListener(g,"position_changed",j));f.UseEventListener(google.maps.event.addListener(f,"click",h));f.UseEventListener(google.maps.event.addListener(g,"dragend",h));j();f.getSingletonInfoWindow().open(f,g);l();if(c.Options.Markers!=null){for(i in c.Options.Markers){var n=new google.maps.Marker();n.Initialize(c.Options.Markers[i]);f.AddMarker(n)}d()}}function l(){a.css("top",$(window).scrollTop()).css("height",$(window).height())}function j(){f.getSingletonInfoWindow().close();var m=c.GetCoordinates();var n=Coordinates.Create(Latitude.Create(g.getPosition().lat()),Longitude.Create(g.getPosition().lng()));n.InputFormat=function(){return m.IsValid()&&m.IsSpecified()?m.InputFormat():CoordinatesFormat.Default};k(n)}function h(m){var n=m.latLng;g.setPosition(n);f.panTo(n)}function d(){if(f.getMarkers().length==0){f.panTo(g.getPosition())}else{var m=new google.maps.LatLngBounds();m.extend(g.getPosition());for(var n in f.getMarkers()){m.extend(f.getMarkers()[n].getPosition())}f.fitBounds(m)}}function b(){f.DisposeMarkers();f.DisposeEventListeners();$(window).unbind("resize").unbind("keyup");a.find("form.CoordinatePickerCoordinates input[name=Action]").unbind("click");a.find("form.CoordinatePickerCoordinates input[name=Coordinates]").unbind("change");a.find("form.CoordinatePickerAddress").unbind("submit");a.remove();$("body").css("overflow","visible")}return c};var CoordinatesFormat={Invalid:0,Unspecified:1,Default:2,DegreesMinutesDecimalSeconds:3,DegreesDecimalMinutes:4,DecimalDegrees:5};var Coordinates={Create:function(a,b){return{Latitude:function(){return a},Longitude:function(){return b},InputFormat:function(){if(this.Latitude().InputFormat()==CoordinatesFormat.Invalid||this.Longitude().InputFormat()==CoordinatesFormat.Invalid){return CoordinatesFormat.Invalid}if(this.Latitude().InputFormat()==CoordinatesFormat.Unspecified||this.Longitude().InputFormat()==CoordinatesFormat.Unspecified){return CoordinatesFormat.Unspecified}return this.Latitude().InputFormat()},IsValid:function(){return this.InputFormat()!=CoordinatesFormat.Invalid},IsSpecified:function(){return this.InputFormat()!=CoordinatesFormat.Unspecified},ToString:function(c){if(!this.Latitude().IsSpecified()||!this.Latitude().IsValid()||!this.Longitude().IsSpecified()||!this.Longitude().IsValid()){return""}return this.Latitude().ToString(c||this.InputFormat())+", "+this.Longitude().ToString(c||this.InputFormat())},Equals:function(c){return this.IsValid()&&c.IsValid()&&this.Latitude().Equals(c.Latitude())&&this.Longitude().Equals(c.Longitude())}}},Parse:function(a){if(a.IsNullOrWhitespace()||!a.Contains(",")){return this.Null()}var b=a.split(",",2);return this.Create(Latitude.Parse(b[0]),Longitude.Parse(b[1]))},Null:function(){return this.Create(Latitude.Null(),Longitude.Null())}};var Longitude={Create:function(a,b){return{TotalDegrees:function(){return a},Sign:function(){return this.TotalDegrees()>=0?1:-1},AbsoluteTotalDegrees:function(){return Math.abs(this.TotalDegrees())},AbsoluteWholeDegrees:function(){return Math.floor(this.AbsoluteTotalDegrees())},AbsoluteMinutes:function(){return 60*(this.AbsoluteTotalDegrees()-this.AbsoluteWholeDegrees())},AbsoluteWholeMinutes:function(){return Math.floor(this.AbsoluteMinutes())},AbsoluteSeconds:function(){return 60*(this.AbsoluteMinutes()-this.AbsoluteWholeMinutes())},IsSpecified:function(){return this.InputFormat()!=CoordinatesFormat.Unspecified},IsValid:function(){return this.InputFormat()!=CoordinatesFormat.Invalid&&this.TotalDegrees()>=-180&&this.TotalDegrees()<=180},InputFormat:function(){return b==null?CoordinatesFormat.Default:b},ToString:function(c){switch(c||this.InputFormat()){case CoordinatesFormat.Unspecified:case CoordinatesFormat.Invalid:return"";case CoordinatesFormat.DegreesMinutesDecimalSeconds:return(this.AbsoluteWholeDegrees()*this.Sign())+" "+this.AbsoluteWholeMinutes()+" "+this.AbsoluteSeconds().toFixed(1);case CoordinatesFormat.DecimalDegrees:return(this.AbsoluteTotalDegrees()*this.Sign()).toFixed(5);case CoordinatesFormat.Default:case CoordinatesFormat.DegreesDecimalMinutes:default:return(this.AbsoluteWholeDegrees()*this.Sign())+" "+this.AbsoluteMinutes().toFixed(3)}},Equals:function(c){return this.IsValid()&&c.IsValid()&&this.TotalDegrees()==c.TotalDegrees()}}},Parse:function(f){var d=/^\s*([-+])?([0-9]{1,3})\s+([0-9]{1,2})\s+([0-9]{1,2}(?:\.[0-9]+)?)\s*$/;var c=/^\s*([-+])?([0-9]{1,3})\s+([0-9]{1,2}(?:\.[0-9]+)?)\s*$/;var a=/^\s*([-+])?([0-9]{1,3}(?:\.[0-9]+)?)\s*$/;var k,b,h,j,e;if(f.IsNullOrWhitespace()){k=1;b=0;h=0;j=0;e=CoordinatesFormat.Unspecified}else{if(d.test(f)){var g=d.exec(f);k="-"==g[1]?-1:1;b=parseFloat(g[2]);h=parseFloat(g[3]);j=parseFloat(g[4]);e=CoordinatesFormat.DegreesMinutesDecimalSeconds}else{if(c.test(f)){var g=c.exec(f);k="-"==g[1]?-1:1;b=parseFloat(g[2]);h=parseFloat(g[3]);j=0;e=CoordinatesFormat.DegreesDecimalMinutes}else{if(a.test(f)){var g=a.exec(f);k="-"==g[1]?-1:1;b=parseFloat(g[2]);h=0;j=0;e=CoordinatesFormat.DecimalDegrees}else{k=1;b=0;h=0;j=0;e=CoordinatesFormat.Invalid}}}}return this.Create((k*(b+(h/60)+(j/3600))).RoundToDecimals(5),e)},Null:function(){return this.Create(0,CoordinatesFormat.Unspecified)}};var Latitude={Create:function(a,b){return{TotalDegrees:function(){return a},Sign:function(){return this.TotalDegrees()>=0?1:-1},AbsoluteTotalDegrees:function(){return Math.abs(this.TotalDegrees())},AbsoluteWholeDegrees:function(){return Math.floor(this.AbsoluteTotalDegrees())},AbsoluteMinutes:function(){return 60*(this.AbsoluteTotalDegrees()-this.AbsoluteWholeDegrees())},AbsoluteWholeMinutes:function(){return Math.floor(this.AbsoluteMinutes())},AbsoluteSeconds:function(){return 60*(this.AbsoluteMinutes()-this.AbsoluteWholeMinutes())},IsSpecified:function(){return this.InputFormat()!=CoordinatesFormat.Unspecified},IsValid:function(){return this.InputFormat()!=CoordinatesFormat.Invalid&&this.TotalDegrees()>=-90&&this.TotalDegrees()<=90},InputFormat:function(){return b==null?CoordinatesFormat.Default:b},ToString:function(c){switch(c||this.InputFormat()){case CoordinatesFormat.Unspecified:case CoordinatesFormat.Invalid:return"";case CoordinatesFormat.DegreesMinutesDecimalSeconds:return(this.AbsoluteWholeDegrees()*this.Sign())+" "+this.AbsoluteWholeMinutes()+" "+this.AbsoluteSeconds().toFixed(1);case CoordinatesFormat.DecimalDegrees:return(this.AbsoluteTotalDegrees()*this.Sign()).toFixed(5);case CoordinatesFormat.Default:case CoordinatesFormat.DegreesDecimalMinutes:default:return(this.AbsoluteWholeDegrees()*this.Sign())+" "+this.AbsoluteMinutes().toFixed(3)}},Equals:function(c){return this.IsValid()&&c.IsValid()&&this.TotalDegrees()==c.TotalDegrees()}}},Parse:function(f){var d=/^\s*([-+])?([0-9]{1,2})\s+([0-9]{1,2})\s+([0-9]{1,2}(?:\.[0-9]+)?)\s*$/;var c=/^\s*([-+])?([0-9]{1,2})\s+([0-9]{1,2}(?:\.[0-9]+)?)\s*$/;var a=/^\s*([-+])?([0-9]{1,2}(?:\.[0-9]+)?)\s*$/;var k,b,h,j,e;if(f.IsNullOrWhitespace()){k=1;b=0;h=0;j=0;e=CoordinatesFormat.Unspecified}else{if(d.test(f)){var g=d.exec(f);k="-"==g[1]?-1:1;b=parseFloat(g[2]);h=parseFloat(g[3]);j=parseFloat(g[4]);e=CoordinatesFormat.DegreesMinutesDecimalSeconds}else{if(c.test(f)){var g=c.exec(f);k="-"==g[1]?-1:1;b=parseFloat(g[2]);h=parseFloat(g[3]);j=0;e=CoordinatesFormat.DegreesDecimalMinutes}else{if(a.test(f)){var g=a.exec(f);k="-"==g[1]?-1:1;b=parseFloat(g[2]);h=0;j=0;e=CoordinatesFormat.DecimalDegrees}else{k=1;b=0;h=0;j=0;e=CoordinatesFormat.Invalid}}}}return this.Create((k*(b+(h/60)+(j/3600))).RoundToDecimals(5),e)},Null:function(){return this.Create(0,CoordinatesFormat.Unspecified)}};google.maps.Map.prototype.getSingletonInfoWindow=function(){if(!this.internalSingletonInfoWindow){this.internalSingletonInfoWindow=new google.maps.InfoWindow()}return this.internalSingletonInfoWindow};google.maps.Map.prototype.UseEventListener=function(a){if(!this.internalEventListeners){this.internalEventListeners=new Array()}this.internalEventListeners.push(a)};google.maps.Map.prototype.getMarkers=function(){if(!this.internalMarkers){this.internalMarkers=new Array()}return this.internalMarkers};google.maps.Map.prototype.AddMarker=function(a){a.setMap(this);a.NotifyMapZoomChanged(this);var b=this;this.UseEventListener(google.maps.event.addListener(this,"zoom_changed",function(){a.NotifyMapZoomChanged(b)}));this.UseEventListener(google.maps.event.addListener(a,"click",function(){a.ShowInfo(b)}));this.UseEventListener(google.maps.event.addListener(a,"dblclick",function(){a.Focus(b)}));this.getMarkers().push(a)};google.maps.Map.prototype.DisposeEventListeners=function(){if(!this.internalEventListeners){this.internalEventListeners=new Array()}while(this.internalEventListeners.length>0){google.maps.event.removeListener(this.internalEventListeners.pop())}};google.maps.Map.prototype.DisposeMarkers=function(){while(this.getMarkers().length>0){var a=this.getMarkers().pop();a.setMap(null)}};google.maps.Marker.prototype.getLoadedInfo=function(){return this.internalLoadedInfo};google.maps.Marker.prototype.setLoadedInfo=function(a){this.internalLoadedInfo=a};google.maps.Marker.prototype.setOptions=function(a){this.internalOptions=a};google.maps.Marker.prototype.getOptions=function(){return this.internalOptions};google.maps.Marker.prototype.NotifyMapZoomChanged=function(a){if(this.getOptions().MinZoom||this.getOptions().MaxZoom){this.setVisible(a.getZoom()<=this.getOptions().MaxZoom&&a.getZoom()>=this.getOptions().MinZoom)}};google.maps.Marker.prototype.Initialize=function(a){this.setOptions(a);this.setTitle(a.Title);this.setIcon(a.IconUrl);this.setPosition(new google.maps.LatLng(a.Latitude,a.Longitude))};google.maps.Marker.prototype.ShowInfo=function(a){if(this.getLoadedInfo()){a.getSingletonInfoWindow().setContent(this.getLoadedInfo()[0]);a.getSingletonInfoWindow().open(a,this)}else{var b=this;$.get(this.getOptions().InfoLoaderUrl,function(c){b.setLoadedInfo($(c).InitializeUi());a.getSingletonInfoWindow().setContent(b.getLoadedInfo()[0]);a.getSingletonInfoWindow().open(a,b)})}};google.maps.Marker.prototype.Focus=function(a){a.setZoom(this.getOptions().MaxZoom+1);a.panTo(this.getPosition())};(function(a){a.fn.Mapify=function(h){var b={mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID],position:google.maps.ControlPosition.RIGHT_BOTTOM,style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR},zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_BOTTOM},panControl:false,streetViewControl:false};h=a.extend(b,h);function d(j){return new google.maps.LatLng(a(j).attr("data-center-latitude"),a(j).attr("data-center-longitude"))}function f(j){return parseInt(a(j).attr("data-zoom"))||5}function g(j){return a(j).attr("data-ne-latitude")}function c(j){return new google.maps.LatLngBounds(new google.maps.LatLng(a(j).attr("data-sw-latitude"),a(j).attr("data-sw-longitude")),new google.maps.LatLng(a(j).attr("data-ne-latitude"),a(j).attr("data-ne-longitude")))}function e(j){return a(j).attr("data-markerloaderurl")}return this.each(function(){if(this.InternalMap){google.maps.event.trigger(this.InternalMap,"resize");return}h.center=d(this);h.zoom=f(this);var j=new google.maps.Map(this,h);this.InternalMap=j;if(g(this)){j.fitBounds(c(this))}google.maps.event.addListener(j,"zoom_changed",function(){j.getSingletonInfoWindow().close()});a.get(e(this),function(l){for(i in l.Markers){var k=new google.maps.Marker();k.Initialize(l.Markers[i]);j.AddMarker(k)}})})}})(jQuery);(function(a){a.fn.CoordinatePicker=function(c){var b={AddressCalculator:null};c=a.extend(b,c);return this.each(function(){var f=a(this);var e=f.find("button").show();var d=f.find("input[type=text]");e.click(function(){a.get(e.attr("data-markerloaderurl"),function(k){var j=Coordinates.Parse(d.val());if(j.IsValid()&&j.IsSpecified()){CoordinatePicker.Open({Coordinates:j,Zoom:15,Markers:k.Markers,Callback:g});return}if(k.CalculatedCoordinates!=null){CoordinatePicker.Open({Zoom:15,Markers:k.Markers,Callback:g,Coordinates:Coordinates.Create(Latitude.Create(k.CalculatedCoordinates.Latitude),Longitude.Create(k.CalculatedCoordinates.Longitude))});return}if(c.AddressCalculator!=null&&c.AddressCalculator.call(f)!=null){var h=c.AddressCalculator.call(f);new google.maps.Geocoder().geocode({address:h},function(l,m){if(m==google.maps.GeocoderStatus.OK){CoordinatePicker.Open({Markers:k.Markers,Callback:g,Coordinates:Coordinates.Create(Latitude.Create(l[0].geometry.location.lat()),Longitude.Create(l[0].geometry.location.lng()))})}else{CoordinatePicker.Open({Markers:k.Markers,Callback:g})}});return}CoordinatePicker.Open({Markers:k.Markers,Callback:g})});return false});function g(h){if(h.Success){d.val(h.Coordinates.ToString());d.trigger("change")}}})}})(jQuery);